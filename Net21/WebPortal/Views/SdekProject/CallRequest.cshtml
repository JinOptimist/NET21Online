@model WebPortal.Models.CallRequestViewModel

@{
    ViewData["Title"] = "Заказ обратного звонка";
}

<!-- Шапка сайта -->
<div class="sdek-header-fullwidth">
    <header class="sdek-header">
        <div class="sdek-header-container">
            <a href="/" class="sdek-logo">
                <img src="~/images/sdek-project-images/logo.png" alt="CDEK" width="160">
            </a>
            <nav class="sdek-nav">
                <a href="#promo" class="nav-promo">Акция для новых клиентов</a>
                <a href="#project" class="nav-project">СДЭК-ПРОЕКТ</a>
            </nav>
        </div>
    </header>
</div>

<!-- Форма заявки -->
<div class="call-request-form-container">
    <h2>Закажите обратный звонок</h2>

    <form id="callRequestForm" asp-action="CreateRequest" method="post">
        <div>
            <label for="Name">Имя</label>
            <input type="text" id="Name" name="Name" required />
        </div>
        <div>
            <label for="PhoneNumber">Телефон</label>
            <input type="text" id="PhoneNumber" name="PhoneNumber" required />
        </div>
        <div>
            <label for="Question">Вопрос</label>
            <textarea id="Question" name="Question" required></textarea>
        </div>
        <button type="submit">Отправить заявку</button>
    </form>

    <div id="successMessage" style="display:none; color: green; margin-top: 10px;">
        Заявка отправлена! Менеджер отдела продаж с Вами свяжется в течение 15 минут.
    </div>
</div>

<script>
    const form = document.getElementById('callRequestForm');
    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                // Показываем сообщение и возвращаем на главную страницу СДЕК
                document.getElementById('successMessage').style.display = 'block';
                setTimeout(() => {
                    window.location.href = 'https://www.cdek.ru/';
                }, 3000); // 3 секунды и редирект
            } else {
                const result = await response.json();
                alert('Ошибка: ' + JSON.stringify(result));
            }
        } catch (err) {
            console.error(err);
            alert('Ошибка при отправке заявки!');
        }
    });
</script>